<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Willow Cricket Channels</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.10/shaka-player.compiled.js"></script>
    <style>
        .modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.95);
        }
        .video-container {
            aspect-ratio: 16/9;
        }
        .channel-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .channel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        @media (max-width: 640px) {
            .modal-content {
                width: 95% !important;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div class="flex items-center mb-4 md:mb-0">
                <img src="https://www.willow.tv/images/willow-logo.png" alt="Willow Cricket Logo" class="h-12 mr-4">
                <h1 class="text-3xl font-bold bg-gradient-to-r from-green-500 to-blue-600 bg-clip-text text-transparent">Willow Cricket Channels</h1>
            </div>
            <div class="text-gray-400 text-sm">
                <p>Live cricket streaming in high quality</p>
            </div>
        </header>

        <!-- Channel Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <!-- Willow Cricket SD -->
            <div class="channel-card bg-gray-800 rounded-xl overflow-hidden shadow-lg cursor-pointer" onclick="playStream('https://a201aivottlinear-a.akamaihd.net/OTTB/lhr-nitro/clients/dash/enc/f60kqesunw/out/v1/a435ed7a00f947deb4369b46d8f2fb70/cenc.mpd', 'Willow Cricket SD')">
                <div class="relative">
                    <img src="https://www.willow.tv/images/willow-channel-poster.jpg" alt="Willow Cricket" class="w-full h-64 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center">
                        <div class="bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium absolute top-3 left-3">
                            LIVE
                        </div>
                        <div class="text-center">
                            <i class="fas fa-play-circle text-4xl text-white opacity-80 hover:opacity-100"></i>
                        </div>
                    </div>
                </div>
                <div class="p-4">
                    <h2 class="text-xl font-bold mb-1">Willow Cricket</h2>
                    <p class="text-gray-400 text-sm">Standard Definition</p>
                    <div class="flex items-center mt-3 text-sm">
                        <span class="bg-blue-900 text-blue-300 px-2 py-1 rounded-full mr-2">MPD</span>
                        <span class="text-gray-500">Cricket Live</span>
                    </div>
                </div>
            </div>

            <!-- Willow Cricket HD -->
            <div class="channel-card bg-gray-800 rounded-xl overflow-hidden shadow-lg cursor-pointer" onclick="playStream('https://a201aivottlinear-a.akamaihd.net/OTTB/lhr-nitro/clients/dash/enc/f60kqesunw/out/v1/a435ed7a00f947deb4369b46d8f2fb70/cenc.mpd', 'Willow Cricket HD')">
                <div class="relative">
                    <img src="https://www.willow.tv/images/willow-hd-poster.jpg" alt="Willow Cricket HD" class="w-full h-64 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center">
                        <div class="bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium absolute top-3 left-3">
                            LIVE
                        </div>
                        <div class="text-center">
                            <i class="fas fa-play-circle text-4xl text-white opacity-80 hover:opacity-100"></i>
                        </div>
                    </div>
                </div>
                <div class="p-4">
                    <h2 class="text-xl font-bold mb-1">Willow Cricket HD</h2>
                    <p class="text-gray-400 text-sm">High Definition</p>
                    <div class="flex items-center mt-3 text-sm">
                        <span class="bg-blue-900 text-blue-300 px-2 py-1 rounded-full mr-2">MPD</span>
                        <span class="text-gray-500">Cricket Live</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="bg-gray-800 rounded-xl p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">About Willow Cricket</h2>
            <p class="text-gray-300 mb-4">
                Willow Cricket is the premier destination for cricket fans, offering live matches, highlights, and exclusive content. 
                Watch your favorite teams and players in action with our high-quality streaming service.
            </p>
            <div class="flex flex-wrap gap-4">
                <div class="flex items-center bg-gray-700 px-4 py-2 rounded-lg">
                    <i class="fas fa-trophy text-yellow-400 mr-2"></i>
                    <span>Live Matches</span>
                </div>
                <div class="flex items-center bg-gray-700 px-4 py-2 rounded-lg">
                    <i class="fas fa-video text-blue-400 mr-2"></i>
                    <span>Highlights</span>
                </div>
                <div class="flex items-center bg-gray-700 px-4 py-2 rounded-lg">
                    <i class="fas fa-mobile-alt text-green-400 mr-2"></i>
                    <span>Multi-Device</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Player -->
    <div id="playerModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="modal-content bg-gray-900 rounded-xl shadow-2xl w-full max-w-6xl relative overflow-hidden">
            <div class="absolute top-4 right-4 z-10 flex gap-2">
                <button id="fullscreenBtn" class="p-2 bg-gray-800 bg-opacity-70 rounded-full hover:bg-gray-700 transition-colors">
                    <i class="fas fa-expand"></i>
                </button>
                <button id="closeModal" class="p-2 bg-gray-800 bg-opacity-70 rounded-full hover:bg-gray-700 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="video-container w-full bg-black relative">
                <video 
                    id="videoElement" 
                    class="w-full h-full" 
                    controls
                    autoplay
                ></video>
                
                <div id="loadingSpinner" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-70">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"></div>
                </div>
                
                <div id="errorDisplay" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden">
                    <div class="text-center p-6 max-w-md">
                        <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">Playback Error</h3>
                        <p id="errorMessage" class="text-gray-300 mb-4">Failed to load the stream. Please try again later.</p>
                        <button id="retryBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg">Retry</button>
                    </div>
                </div>
            </div>
            
            <div class="p-4 bg-gray-800">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4">
                    <h2 id="streamTitle" class="text-xl font-semibold truncate max-w-xs">Willow Cricket</h2>
                    <div class="flex items-center gap-2 text-sm text-gray-400">
                        <span id="streamTypeBadge" class="px-2 py-1 rounded-full bg-blue-900 text-blue-300">MPD</span>
                        <span id="streamInfo" class="hidden sm:inline">Loading...</span>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-4 items-center">
                    <div class="flex items-center gap-2">
                        <button id="playPauseBtn" class="p-2 bg-gray-700 hover:bg-gray-600 rounded-full">
                            <i class="fas fa-play"></i>
                        </button>
                        <button id="muteBtn" class="p-2 bg-gray-700 hover:bg-gray-600 rounded-full">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <input 
                            id="volumeSlider" 
                            type="range" 
                            min="0" 
                            max="1" 
                            step="0.1" 
                            value="1" 
                            class="w-24 accent-blue-500"
                        >
                    </div>
                    
                    <div class="flex-grow flex items-center gap-2">
                        <span id="currentTime" class="text-sm w-12">0:00</span>
                        <input 
                            id="progressBar" 
                            type="range" 
                            min="0" 
                            max="100" 
                            value="0" 
                            class="flex-grow accent-blue-500"
                        >
                        <span id="duration" class="text-sm w-12">0:00</span>
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <button id="qualityBtn" class="p-2 bg-gray-700 hover:bg-gray-600 rounded-full hidden">
                            <i class="fas fa-cog"></i>
                        </button>
                        <div id="qualityMenu" class="absolute bg-gray-800 rounded-lg shadow-lg py-1 z-10 hidden">
                            <div class="px-4 py-2 hover:bg-gray-700 cursor-pointer">Auto</div>
                            <!-- Quality options will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Shaka Player
            if (!shaka.Player.isBrowserSupported()) {
                console.error('Browser not supported for Shaka Player');
                return;
            }

            const video = document.getElementById('videoElement');
            const player = new shaka.Player(video);
            const ui = video.ui;
            const controls = ui.getControls();
            const playerElement = ui.getControls().getPlayerElement();

            // Hide default controls and use our custom ones
            playerElement.classList.add('no-fullscreen');

            // Elements
            const playerModal = document.getElementById('playerModal');
            const closeModal = document.getElementById('closeModal');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const errorDisplay = document.getElementById('errorDisplay');
            const errorMessage = document.getElementById('errorMessage');
            const retryBtn = document.getElementById('retryBtn');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const muteBtn = document.getElementById('muteBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            const progressBar = document.getElementById('progressBar');
            const currentTime = document.getElementById('currentTime');
            const duration = document.getElementById('duration');
            const qualityBtn = document.getElementById('qualityBtn');
            const qualityMenu = document.getElementById('qualityMenu');
            const streamTitle = document.getElementById('streamTitle');
            const streamTypeBadge = document.getElementById('streamTypeBadge');
            const streamInfo = document.getElementById('streamInfo');

            // State
            let isFullscreen = false;
            let isQualityMenuOpen = false;
            let currentStreamUrl = '';
            let qualityOptions = [];

            // Close modal
            closeModal.addEventListener('click', closePlayerModal);

            // Retry button
            retryBtn.addEventListener('click', () => {
                if (currentStreamUrl) {
                    loadStream(currentStreamUrl);
                }
            });

            // Fullscreen button
            fullscreenBtn.addEventListener('click', toggleFullscreen);

            // Play/Pause button
            playPauseBtn.addEventListener('click', togglePlayPause);

            // Mute button
            muteBtn.addEventListener('click', toggleMute);

            // Volume slider
            volumeSlider.addEventListener('input', () => {
                video.volume = volumeSlider.value;
                if (video.volume > 0) {
                    video.muted = false;
                    muteBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                }
            });

            // Progress bar
            progressBar.addEventListener('input', () => {
                const seekTime = (progressBar.value / 100) * video.duration;
                video.currentTime = seekTime;
            });

            // Quality button
            qualityBtn.addEventListener('click', toggleQualityMenu);

            // Video events
            video.addEventListener('timeupdate', updateProgressBar);
            video.addEventListener('loadedmetadata', updateVideoInfo);
            video.addEventListener('play', updatePlayPauseButton);
            video.addEventListener('pause', updatePlayPauseButton);
            video.addEventListener('volumechange', updateVolumeControls);
            video.addEventListener('waiting', () => loadingSpinner.classList.remove('hidden'));
            video.addEventListener('playing', () => loadingSpinner.classList.add('hidden'));
            video.addEventListener('error', handlePlayerError);

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (!playerModal.classList.contains('opacity-100')) return;
                
                switch (e.key) {
                    case ' ':
                        e.preventDefault();
                        togglePlayPause();
                        break;
                    case 'f':
                        toggleFullscreen();
                        break;
                    case 'm':
                        toggleMute();
                        break;
                    case 'Escape':
                        if (isFullscreen) toggleFullscreen();
                        else closePlayerModal();
                        break;
                }
            });

            // Global function to play stream (called from channel cards)
            window.playStream = function(url, title) {
                currentStreamUrl = url;
                streamTitle.textContent = title;
                openPlayerModal();
                loadStream(url);
            };

            // Functions
            function openPlayerModal() {
                playerModal.classList.remove('opacity-0', 'pointer-events-none');
                playerModal.classList.add('opacity-100', 'pointer-events-auto');
                document.body.style.overflow = 'hidden';
                
                // Set stream type badge
                if (currentStreamUrl.includes('.mpd')) {
                    streamTypeBadge.textContent = 'MPD';
                    streamTypeBadge.className = 'px-2 py-1 rounded-full bg-blue-900 text-blue-300';
                } else if (currentStreamUrl.includes('.m3u8')) {
                    streamTypeBadge.textContent = 'HLS';
                    streamTypeBadge.className = 'px-2 py-1 rounded-full bg-purple-900 text-purple-300';
                }
            }

            function closePlayerModal() {
                playerModal.classList.remove('opacity-100', 'pointer-events-auto');
                playerModal.classList.add('opacity-0', 'pointer-events-none');
                document.body.style.overflow = 'auto';
                
                // Pause video and reset
                video.pause();
                video.src = '';
                player.detach();
                
                // Reset UI
                loadingSpinner.classList.add('hidden');
                errorDisplay.classList.add('hidden');
                progressBar.value = 0;
                currentTime.textContent = '0:00';
                duration.textContent = '0:00';
                qualityBtn.classList.add('hidden');
                qualityMenu.classList.add('hidden');
            }

            async function loadStream(url) {
                try {
                    loadingSpinner.classList.remove('hidden');
                    errorDisplay.classList.add('hidden');
                    
                    player.detach();
                    player.resetConfiguration();
                    
                    // Configure player
                    player.configure({
                        streaming: {
                            bufferingGoal: 60,
                            rebufferingGoal: 2,
                            bufferBehind: 30,
                            ignoreTextStreamFailures: true
                        },
                        abr: {
                            enabled: true,
                            defaultBandwidthEstimate: 500000,
                            switchInterval: 2
                        }
                    });

                    // Attach player to video element
                    await player.attach(video);
                    
                    // Load the stream
                    await player.load(url);
                    
                    // Show quality options if available
                    setupQualityOptions();
                    
                    loadingSpinner.classList.add('hidden');
                } catch (error) {
                    console.error('Error loading stream:', error);
                    loadingSpinner.classList.add('hidden');
                    errorDisplay.classList.remove('hidden');
                    errorMessage.textContent = error.message || 'Failed to load the stream. Please try again later.';
                }
            }

            function setupQualityOptions() {
                const tracks = player.getVariantTracks();
                
                if (tracks.length > 1) {
                    qualityOptions = tracks;
                    qualityBtn.classList.remove('hidden');
                    
                    // Clear existing options
                    qualityMenu.innerHTML = '';
                    
                    // Add Auto option
                    const autoOption = document.createElement('div');
                    autoOption.className = 'px-4 py-2 hover:bg-gray-700 cursor-pointer';
                    autoOption.textContent = 'Auto';
                    autoOption.addEventListener('click', () => {
                        player.configure({ abr: { enabled: true } });
                        qualityMenu.classList.add('hidden');
                    });
                    qualityMenu.appendChild(autoOption);
                    
                    // Add quality options
                    tracks.forEach(track => {
                        const option = document.createElement('div');
                        option.className = 'px-4 py-2 hover:bg-gray-700 cursor-pointer';
                        
                        const height = track.height || Math.round(track.width * 9/16);
                        option.textContent = `${height}p (${Math.round(track.bandwidth / 1000)} kbps)`;
                        
                        option.addEventListener('click', () => {
                            player.configure({ abr: { enabled: false } });
                            player.selectVariantTrack(track);
                            qualityMenu.classList.add('hidden');
                        });
                        
                        qualityMenu.appendChild(option);
                    });
                } else {
                    qualityBtn.classList.add('hidden');
                }
            }

            function toggleFullscreen() {
                const modalContent = document.querySelector('.modal-content');
                
                if (!isFullscreen) {
                    if (modalContent.requestFullscreen) {
                        modalContent.requestFullscreen();
                    } else if (modalContent.webkitRequestFullscreen) {
                        modalContent.webkitRequestFullscreen();
                    } else if (modalContent.msRequestFullscreen) {
                        modalContent.msRequestFullscreen();
                    }
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                }
                
                isFullscreen = !isFullscreen;
            }

            function togglePlayPause() {
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            }

            function toggleMute() {
                video.muted = !video.muted;
                updateVolumeControls();
            }

            function toggleQualityMenu() {
                isQualityMenuOpen = !isQualityMenuOpen;
                if (isQualityMenuOpen) {
                    qualityMenu.classList.remove('hidden');
                } else {
                    qualityMenu.classList.add('hidden');
                }
            }

            function updateProgressBar() {
                if (video.duration) {
                    const percent = (video.currentTime / video.duration) * 100;
                    progressBar.value = percent;
                    
                    // Update time displays
                    currentTime.textContent = formatTime(video.currentTime);
                    duration.textContent = formatTime(video.duration);
                }
            }

            function updateVideoInfo() {
                streamInfo.textContent = `${video.videoWidth}x${video.videoHeight} @ ${Math.round(video.bitrate / 1000)} kbps`;
                streamInfo.classList.remove('hidden');
            }

            function updatePlayPauseButton() {
                if (video.paused) {
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                } else {
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                }
            }

            function updateVolumeControls() {
                if (video.muted || video.volume === 0) {
                    muteBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    volumeSlider.value = 0;
                } else {
                    muteBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                    volumeSlider.value = video.volume;
                }
            }

            function handlePlayerError() {
                loadingSpinner.classList.add('hidden');
                errorDisplay.classList.remove('hidden');
                errorMessage.textContent = video.error ? video.error.message : 'An unknown playback error occurred.';
            }

            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
            }

            // Close quality menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!qualityMenu.contains(e.target) && e.target !== qualityBtn) {
                    qualityMenu.classList.add('hidden');
                    isQualityMenuOpen = false;
                }
            });

            // Handle fullscreen change events
            document.addEventListener('fullscreenchange', () => {
                isFullscreen = !!document.fullscreenElement;
                fullscreenBtn.innerHTML = isFullscreen ? '<i class="fas fa-compress"></i>' : '<i class="fas fa-expand"></i>';
            });
        });
    </script>
</body>
</html>
